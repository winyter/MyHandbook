# varchar 格式长度设置详解

### varchar 格式长度设置详解

- varchar 存储规则

  4.0 版本以下，varchar(20)，指的是20字节，如果存放 UTF8 汉字时，只能存6个（每个汉字3字节）

  5.0 版本以上，varchar(20)，指的是20字符，无论存放的是数字、字母还是 UTF8 汉字（每个汉字3字节），都可以存放20个，最大大小是 65532 字节

- MySQL 中 varchar 最大长度是多少

  最大长度并不是固定的，有以下限制规则

  1. 存储限制

     varchar 字段是将实际内容单独存储在聚簇索引之外，内容开头⽤1到2个字节表⽰实际长度（长度超过255时需要2个字节），因此最⼤长度不能超过65535

  2. 编码长度限制

     字符类型若为 gbk，每个字符最多占 2 个字节，最大长度不能超过 32766

     > 32766 = (65535 - 1 - 2) / 2
     >
     > 减 1 的原因是实际行存储从第二个字节开始
     > 减 2 的原因是 varchar 头部的 2 个字节表示长度
     > 除 2 的原因是字符编码是 GBK

     字符类型若为 utf8，每个字符最多占 3 个字节，最大长度不能超过 21844

     > 21844 = (65535 - 1 - 2) / 3
     >
     > 减 1 减 2 的原因同上
     > 除 3 的原因是字符编码是 UTF8

     若定义的时候超过上述限制，则 varchar 字段会被强制转换为 text 类型，并产生 warning

  3. 行长度限制

     导致实际应⽤中varchar长度限制最大值的另一个因素是⾏定义的长度。 MySQL要求⼀个⾏的定义长度不能超过65535。若定义的表长度超过这个值，则提⽰

     ```
     ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. You have to change some columns to TEXT or BLOBs
     ```

     此处举例说明该点

     ```sql
     create table t4(c int, c2 char(30), c3 varchar(N)) charset=utf8;
     ```

     此处N的最⼤值为 $(65535-1-2-4-30*3)/3=21812$

     > 减 1 减 2 和除 3 的原因 与上例相同;
     > 减 4 的原因是 int 类型的 c 占 4 个字节;
     > 减 30*3 的原因是char(30)占⽤ 90 个字节，编码是utf8。
