# Shell 退出状态

每一条 Shell 命令，不管是 Bash 内置命令（例如 cd、echo），还是外部的 Linux 命令（例如 ls、awk），还是自定义的 Shell 函数，当它退出（运行结束）时，都会返回一个比较小的整数值给调用（使用）它的程序，这就是命令的退出状态（exit statu）。

很多 Linux 命令其实就是一个C语言程序，熟悉C语言的读者都知道，main() 函数的最后都有一个return 0，如果程序想在中间退出，还可以使用exit 0，这其实就是C语言程序的退出状态。当有其它程序调用这个程序时，就可以捕获这个退出状态。

if 语句的判断条件，从本质上讲，判断的就是命令的退出状态。

按照惯例来说，退出状态为 0 表示“成功”；也就是说，程序执行完成并且没有遇到任何问题。除 0 以外的其它任何退出状态都为“失败”。

之所以说这是“惯例”而非“规定”，是因为也会有例外，比如 diff 命令用来比较两个文件的不同，对于“没有差别”的文件返回 0，对于“找到差别”的文件返回 1，对无效文件名返回 2。

有编程经验的读者请注意，Shell 的这个部分与你所熟悉的其它编程语言正好相反：在C语言、C++、Java、Python 中，0 表示“假”，其它值表示“真”。

在 Shell 中，有多种方式取得命令的退出状态，其中 $? 是最常见的一种。

Shell 中运行的命令会使用0-255之间的整数值，作为退出状态码,并以此来告知shell该命令执行的状态。通常情况下，约定0代表命令成功结束，非0代表程序非正常退出。

典型退出状态码及其含义：

| 退出状态码 | 含义                 |
| ---------- | -------------------- |
| 0          | 命令运行成功         |
| 1          | 通知未知错误         |
| 2          | 误用shell命令        |
| 126        | 命令不可执行         |
| 127        | 没有找到命令         |
| 128        | 无效退出参数         |
| 128+x      | linux信号x的严重错误 |
| 130        | 命令通过Ctrl+C终止   |
| 255        | 退出状态码越界       |

Shell退出状态码：

1、 假如没有指定返回值，那么会用脚本的最后一个命令的执行状态，作为退出的状态码，支持用exit命令指定退出码。退出的状态码范围是0~255，如果自定义的退出码不在范围内，会对其执行取模运算；

2、 假如执行的是一个有返回值的函数或者程序，那么执行结束的返回值会被当做当前函数或程序的退出状态值。
